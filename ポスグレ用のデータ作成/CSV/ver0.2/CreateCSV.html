<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ãƒ†ãƒ¼ãƒ–ãƒ«ç·¨é›†</title>
    <style>
        .container {
            display: flex;
            justify-content: space-between;
        }
        .left {
            width: 33.33%;
        }
        .center {
            width: 33.33%;
            padding-left: 10px; /* çœŸã‚“ä¸­ã®ä½™ç™½ã‚’èª¿æ•´ */
            padding-right: 10px;
            border-left: 2px solid #ddd;
            border-right: 2px solid #ddd;
        }
        .right {
            width: 33.33%;
            padding-left: 10px;
        }
        
        button {
            margin-top: 10px;
        }
        .codes {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4åˆ—è¡¨ç¤º */
            row-gap: 5px; /* ğŸ”¹ è¡Œã®é–“éš” */
            column-gap: 1px; /* ğŸ”¹ åˆ—ã®é–“éš” */
            padding-left: 20px;
        }
        

        /* ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆãƒœã‚¿ãƒ³ã‚’å¼·èª¿ */
		#processButton {
		    background-color: #ffcc00; /* é»„è‰² */
		    font-weight: bold;
		    padding: 10px 15px;
		    border: 2px solid #ffaa00; /* æ¿ƒã„ã‚ªãƒ¬ãƒ³ã‚¸æ  */
		    border-radius: 5px;
		    cursor: pointer;
		}

		/* ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚’æ°´è‰²ã« */
		#downloadButton {
		    background-color: #00aaff; /* æ°´è‰² */
		    color: white;
		    font-weight: bold;
		    padding: 10px 15px;
		    border: 2px solid #0077cc; /* æ¿ƒã„æ°´è‰²ã®æ  */
		    border-radius: 5px;
		    cursor: pointer;
		}

		/* ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰(10è¡Œ)ãƒœã‚¿ãƒ³ã‚’èµ¤è‰²ã« */
		#downloadButton10 {
			background-color: #ff4444; /* èµ¤è‰² */
		    color: white;
		    font-weight: bold;
		    padding: 10px 15px;
		    border: 2px solid #cc0000; /* æ¿ƒã„èµ¤è‰²ã®æ  */
		    border-radius: 5px;
		    cursor: pointer;
		}
		
		
        .tooltip {
          position: relative;
          display: inline-block;
          //cursor: help;
        }
        .tooltip::after {
          content: attr(data-tip);
          position: absolute;
          top: -8px; /* ä¸Šã«å°‘ã—ãšã‚‰ã™ */
          left: 100%; /* è¦ç´ ã®å³ç«¯ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆ */
          transform: translateY(-100%) translateX(0);
          background: white;
          color: black;
          padding: 2px 6px; /* å°‘ã—æ§ãˆã‚ã« */
          border-radius: 4px;
          white-space: nowrap;
          opacity: 0;
          pointer-events: none;
          transition: opacity 0.2s;
          z-index: 10;
          border: 1px solid #ccc;
          box-shadow: 2px 2px 6px rgba(0,0,0,0.3);
          
          /* è¿½åŠ ã§æ³¨é‡ˆã®è¦‹ãŸç›®ã‚’å¼•ãç· ã‚ã‚‹ */
          font-size: 14px;
          font-weight: normal;
          line-height: 1.2;
        }
        .tooltip:hover::after {
          opacity: 1;
        }
		
    </style>
</head>
<script>
    const tableNameHeader = 'year, birth_count, region, prefecture_code, avg_life_expectancy, male_ratio, female_ratio, urban_ratio, rural_ratio, infant_mortality_rate, healthcare_index\n';
    
    /*
    let tableName = {
        seq:                   100000,
        year:                  '2020/01/01 12:34:56',
        birth_count:           530000,
        region:                'Tokyo',
        prefecture_code:       '13',
        avg_life_expectancy:   '76.5',
        male_ratio:            '51.2',
        female_ratio:          '48.8',
        urban_ratio:           '80.1',
        rural_ratio:           '19.9',
        infant_mortality_rate: '2.5',
        healthcare_index:      '78'
    };
    */
    
    let tableName = {
        seq:                   '100005',
        year:                  '2020/01/01 12:34:56',
        birth_count:           530000,
        region:                'Tokyo',
        prefecture_code:       ' ',
        avg_life_expectancy:   '76.5',
        male_ratio:            '51.2',
        female_ratio:          '48.8',
        urban_ratio:           '80.1',
        rural_ratio:           '19.9',
        infant_mortality_rate: '2.5',
        healthcare_index:       null

    };
    
    let processedArray;
    let csvContent = "";

    function updateName() {
        const newName = document.getElementById('nameInput').value;
        if (newName.trim() !== '') {
            // ã¡ã‚ƒã‚“ã¨å…¥åŠ›ã•ã‚ŒãŸå ´åˆã®ã¿æœ‰åŠ¹ï¼ˆå…¥åŠ›ã•ã‚ŒãŸåå‰ãŒç©ºã‚„ã‚¹ãƒšãƒ¼ã‚¹ã§ãªã„å ´åˆï¼‰
            tableName.name = newName;
            displayData();
        }
    }

    function processTableName() {
        // ã€Œ""ã€ã§å›²ã‚€ã‹ã©ã†ã‹ã®åˆ¤å®š
        processedArray = Object.values(tableName).map(value =>
            (typeof value === 'string' && value.trim() === '') ? '""' : // ç©ºæ–‡å­—ã®å ´åˆã¯ã€Œç©ºã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã¨ã™ã‚‹
                (value == null) ? '' : // nullã®å ´åˆã¯ç©ºæ¬„ã€Œ,,ã€ã¨ã™ã‚‹
                    typeof value !== 'string' ? value : // Stringå‹ã§ãªã„ã‚‚ã®ã¯ã€ã€Œ""ã€ã§å›²ã¾ãšã«ãã®ã¾ã¾
                        value.includes("/") || value.includes("-") ? value : // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã®å ´åˆã¯ãã®ã¾ã¾
                            `"${value}"` ); // ãã®ä»–ã¯ "" ã§å›²ã‚€
        
        // ã€Œ,ã€ã§ã¤ãªã
        processedArray.join(', ');
        
        // æœ«å°¾ãŒnullã®å ´åˆã¯ã€Œ,ã€è¿½åŠ 
        if (processedArray.at(-1) == '') {
            console.log(processedArray.at(-1));
            console.log('æœ«å°¾ã«ã€Œ,ã€ã‚’è¿½åŠ ');
            processedArray.push("");
        }
        console.log(processedArray);

        document.getElementById('processedData').innerText = processedArray;
    }

    function processTableName10() {
        
        for (let i = 0; i < 10; i++) {
            let row = Object.entries(tableName).map(([key, value]) => 
                (typeof value === 'string' && value.trim() === '') ? '""' : // ç©ºæ–‡å­—ã®å ´åˆã¯ã€Œç©ºã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã¨ã™ã‚‹
                    (value == null) ? '' : // nullã®å ´åˆã¯ç©ºæ¬„ã€Œ,,ã€ã¨ã™ã‚‹
                        key === 'seq' ? Number(value) + i : // ã€Œã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·ã€ã¯é€£ç¶šã—ãŸå€¤ã«å¤‰åŒ–ã•ã›ã‚‹
                            (typeof value === 'string' && (value.includes("/") || value.includes("-"))) ? value : // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã¯ãã®ã¾ã¾
                                `"${value}"` // ãã®ä»–ã¯ "" ã§å›²ã‚€
            );

            
            // æœ«å°¾ãŒnullã®å ´åˆã¯ã€Œ,ã€è¿½åŠ 
            if (row.at(-1) == '') {
                console.log(row.at(-1));
                console.log('æœ«å°¾ã«ã€Œ,ã€ã‚’è¿½åŠ ');
                row.push("");
            }
            csvContent += row.join(",") + '\n'; // CSVå½¢å¼ã§çµåˆ
        }

        console.log(csvContent); // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›
        document.getElementById('processedData10').innerText = csvContent;
    }
    
    function downloadProcessedArray() {
        if (processedArray == null) {
            processTableName();
        }
        const blob = new Blob([tableNameHeader + processedArray], { type: "text/csv" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "processed_data.csv";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }


    function downloadProcessedArray10() {
        if (csvContent == null) {
            processTableName10();
        }
        const blob = new Blob([tableNameHeader + csvContent], { type: "text/csv" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "processed_data.csv";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }



    /* éƒ½é“åºœçœŒ */
    function updatePrefecture() {
        const prefectureCode = document.getElementById('nameInput').value;
        if (prefectureCode.trim() !== '') {
            // ã¡ã‚ƒã‚“ã¨å…¥åŠ›ã•ã‚ŒãŸå ´åˆã®ã¿æœ‰åŠ¹ï¼ˆå…¥åŠ›ã•ã‚ŒãŸéƒ½é“åºœçœŒã‚³ãƒ¼ãƒ‰ãŒç©ºã‚„ã‚¹ãƒšãƒ¼ã‚¹ã§ãªã„å ´åˆï¼‰
            tableName.region = judgePrefecture(prefectureCode);
            tableName.prefecture_code = prefectureCode;
            displayData();
        }
    }

    function changePrefecture(newPrefectureCode) {
        tableName.region = judgePrefecture(newPrefectureCode);
        tableName.prefecture_code = newPrefectureCode;
        displayData();
    }


    function judgePrefecture(prefectureCode) {
        const prefectureMap = {
            1: "åŒ—æµ·é“", 2: "é’æ£®çœŒ", 3: "å²©æ‰‹çœŒ", 4: "å®®åŸçœŒ", 5: "ç§‹ç”°çœŒ",
            6: "å±±å½¢çœŒ", 7: "ç¦å³¶çœŒ", 8: "èŒ¨åŸçœŒ", 9: "æ ƒæœ¨çœŒ", 10: "ç¾¤é¦¬çœŒ",
            11: "åŸ¼ç‰çœŒ", 12: "åƒè‘‰çœŒ", 13: "æ±äº¬éƒ½", 14: "ç¥å¥ˆå·çœŒ", 15: "æ–°æ½ŸçœŒ",
            16: "å¯Œå±±çœŒ", 17: "çŸ³å·çœŒ", 18: "ç¦äº•çœŒ", 19: "å±±æ¢¨çœŒ", 20: "é•·é‡çœŒ",
            21: "å²é˜œçœŒ", 22: "é™å²¡çœŒ", 23: "æ„›çŸ¥çœŒ", 24: "ä¸‰é‡çœŒ", 25: "æ»‹è³€çœŒ",
            26: "äº¬éƒ½åºœ", 27: "å¤§é˜ªåºœ", 28: "å…µåº«çœŒ", 29: "å¥ˆè‰¯çœŒ", 30: "å’Œæ­Œå±±çœŒ",
            31: "é³¥å–çœŒ", 32: "å³¶æ ¹çœŒ", 33: "å²¡å±±çœŒ", 34: "åºƒå³¶çœŒ", 35: "å±±å£çœŒ",
            36: "å¾³å³¶çœŒ", 37: "é¦™å·çœŒ", 38: "æ„›åª›çœŒ", 39: "é«˜çŸ¥çœŒ", 40: "ç¦å²¡çœŒ",
            41: "ä½è³€çœŒ", 42: "é•·å´çœŒ", 43: "ç†Šæœ¬çœŒ", 44: "å¤§åˆ†çœŒ", 45: "å®®å´çœŒ",
            46: "é¹¿å…å³¶çœŒ", 47: "æ²–ç¸„çœŒ"
        };
        
        if (prefectureMap.hasOwnProperty(prefectureCode)) {
            // æœ‰åŠ¹ãªéƒ½é“åºœçœŒã‚³ãƒ¼ãƒ‰ã®å ´åˆ
            return prefectureMap[code = prefectureCode];
        } else {
            // æœ‰åŠ¹ãªéƒ½é“åºœçœŒã‚³ãƒ¼ãƒ‰ã§ãªã„å ´åˆ
            alert("ç„¡åŠ¹ãªéƒ½é“åºœçœŒã‚³ãƒ¼ãƒ‰: " + prefectureCode + "\nå³è¨˜ã®éƒ½é“åºœçœŒã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        }
        //return prefectureMap[code = prefectureCode];
    }



    function displayData() {
        document.getElementById('display').innerHTML = 
            `ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·: ${tableName.seq}<br>
             è¨˜éŒ²å¹´:            ${tableName.year}<br>
             å‡ºç”Ÿæ•°:            ${tableName.birth_count}<br>
             åœ°åŸŸ:              ${tableName.region}<br>
             éƒ½é“åºœçœŒã‚³ãƒ¼ãƒ‰:    ${tableName.prefecture_code}<br>
             å¹³å‡å¯¿å‘½:          ${tableName.avg_life_expectancy}<br>
             ç”·æ€§ã®å‰²åˆï¼ˆ%ï¼‰:   ${tableName.male_ratio}<br>
             å¥³æ€§ã®å‰²åˆï¼ˆ%ï¼‰:   ${tableName.female_ratio}<br>
             éƒ½å¸‚éƒ¨ã®æ¯”ç‡ï¼ˆ%ï¼‰: ${tableName.urban_ratio}<br>
             åœ°æ–¹éƒ¨ã®æ¯”ç‡ï¼ˆ%ï¼‰: ${tableName.rural_ratio}<br>
             ä¹³å…æ­»äº¡ç‡ï¼ˆ%ï¼‰:   ${tableName.infant_mortality_rate}<br>
             å¥åº·åŒ»ç™‚æŒ‡æ•°:      ${tableName.healthcare_index}`;
    }

    window.onload = displayData;
</script>
    
<body>
    <div class="container">
        <!-- å·¦å´: å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="left">
		    <h2>æƒ…å ±ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ </h2>
		    
		    <label for="nameInput">éƒ½é“åºœçœŒ:</label>
		    <input type="text" id="nameInput" placeholder="æ–°ã—ã„éƒ½é“åºœçœŒã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›">
		    <button onclick="updatePrefecture()">å¤‰æ›´</button>
		    
		    <h2 class="tooltip" data-tip="ã“ã‚Œã¯æ³¨é‡ˆã§ã™">éƒ½é“åºœçœŒå¤‰æ›´:</h2><br>
		    <button onclick="changePrefecture(23)">æ„›çŸ¥çœŒ ã«å¤‰æ›´</button>
		    <button onclick="changePrefecture(13)">æ±äº¬éƒ½ ã«å¤‰æ›´</button>
    
		    <h3>ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†:</h3>
		    <button id="processButton" onclick="processTableName()">ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ</button>
    
            <h3>ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†(10è¡Œ):</h3>
            <button id="processButton" onclick="processTableName10()">ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ (10è¡Œ)</button>
        </div>

        <!-- ä¸­å¤®å´: çµæœè¡¨ç¤º -->
        <div class="center">
            <h3>ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿:</h3>
            <p id="display"></p>
            
            <h3>ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿:</h3>
            <p id="processedData"></p>
            
            <h3>ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿ (10è¡Œåˆ†):</h3>
            <p id="processedData10"></p>
            
		    <br>
		    <button id="downloadButton" onclick="downloadProcessedArray()">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
            
		    <br>
		    <button id="downloadButton10" onclick="downloadProcessedArray10()">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰(10è¡Œ)</button>
        </div>

        <!-- å³å´: éƒ½é“åºœçœŒã‚³ãƒ¼ãƒ‰è¡¨ç¤º -->
        <div class="right">
            <h3>éƒ½é“åºœçœŒã‚³ãƒ¼ãƒ‰:</h3>
            <div class="codes">
                <div>01 åŒ—æµ·é“</div>
                <div>02 é’æ£®çœŒ</div>
                <div>03 å²©æ‰‹çœŒ</div>
                <div>04 å®®åŸçœŒ</div>
                <div>05 ç§‹ç”°çœŒ</div>
                <div>06 å±±å½¢çœŒ</div>
                <div>07 ç¦å³¶çœŒ</div>
                <div>08 èŒ¨åŸçœŒ</div>
                <div>09 æ ƒæœ¨çœŒ</div>
                <div>10 ç¾¤é¦¬çœŒ</div>
                <div>11 åŸ¼ç‰çœŒ</div>
                <div>12 åƒè‘‰çœŒ</div>
                <div>13 æ±äº¬éƒ½</div>
                <div>14 ç¥å¥ˆå·çœŒ</div>
                <div>15 æ–°æ½ŸçœŒ</div>
                <div>16 å¯Œå±±çœŒ</div>
                <div>17 çŸ³å·çœŒ</div>
                <div>18 ç¦äº•çœŒ</div>
                <div>19 å±±æ¢¨çœŒ</div>
                <div>20 é•·é‡çœŒ</div>
                <div>21 å²é˜œçœŒ</div>
                <div>22 é™å²¡çœŒ</div>
                <div>23 æ„›çŸ¥çœŒ</div>
                <div>24 ä¸‰é‡çœŒ</div>
                <div>25 æ»‹è³€çœŒ</div>
                <div>26 äº¬éƒ½åºœ</div>
                <div>27 å¤§é˜ªåºœ</div>
                <div>28 å…µåº«çœŒ</div>
                <div>29 å¥ˆè‰¯çœŒ</div>
                <div>30 å’Œæ­Œå±±çœŒ</div>
                <div>31 é³¥å–çœŒ</div>
                <div>32 å³¶æ ¹çœŒ</div>
                <div>33 å²¡å±±çœŒ</div>
                <div>34 åºƒå³¶çœŒ</div>
                <div>35 å±±å£çœŒ</div>
                <div>36 å¾³å³¶çœŒ</div>
                <div>37 é¦™å·çœŒ</div>
                <div>38 æ„›åª›çœŒ</div>
                <div>39 é«˜çŸ¥çœŒ</div>
                <div>40 ç¦å²¡çœŒ</div>
                <div>41 ä½è³€çœŒ</div>
                <div>42 é•·å´çœŒ</div>
                <div>43 ç†Šæœ¬çœŒ</div>
                <div>44 å¤§åˆ†çœŒ</div>
                <div>45 å®®å´çœŒ</div>
                <div>46 é¹¿å…å³¶çœŒ</div>
                <div>47 æ²–ç¸„çœŒ</div>
            </div>
        </div>
    </div>
</body>
</html>
